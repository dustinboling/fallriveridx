{ "listings": {
    <% @listings.each_with_index do |listing, i| %>
        "<%= listing["ListingID"] %>": { 
        <% if i == @listings.length - 1 %>
                "ListingID": "<%= listing["ListingID"] %>",
                "ListPrice": "<%= number_to_currency(listing["ListPrice"]) %>", 
                "PropertyType": "<%= listing["PropertyType"] %>",
                "FullStreetAddress": "<%= listing["FullStreetAddress"] %>",
                "City": "<%= listing["City"] %>",
                "State": "<%= listing["State"] %>",
                "ZipCode": "<%= listing["ZipCode"] %>",
                "BedroomsTotal": "<%= listing["BedroomsTotal"] %>",
                "BathsTotal": "<%= listing["BathsTotal"] %>",
                "BuildingSize": "<%= listing["BuildingSize"] %>",
                "LotSizeSQFT": "<%= listing["LotSizeSQFT"] %>",
                "YearBuilt": "<%= listing["YearBuilt"] %>",
                "ListingModificationDate": "<%= listing["ListingModificationDate"] %>",
                "Area": "<%= listing["Area"] %>",
                "ListingDate": "<%= listing["ListingDate"] %>",
                "BuildersTractName": "<%= listing["BuildersTractName"] %>",
                "PublicRemarks": "<%= listing["PublicRemarks"] %>",
                "PropertyMedia": [
                    <% listing.property_media.each_with_index do |pm, i| %>
                        <% if i == listing.property_media.length - 1 %>
                            {
                                "PropItemNumber": "<%= pm.PropItemNumber  %>",
                                "PropMediaURL": "<%= pm.PropMediaURL %>"
                            }
                        <% else %>
                            {
                                "PropItemNumber": "<%= pm.PropItemNumber  %>",
                                "PropMediaURL": "<%= pm.PropMediaURL %>"
                            },
                        <% end %>
                    <% end %>
                ]}
        <% else %>
            "ListingID": "<%= listing["ListingID"] %>",
            "ListPrice": "<%= number_to_currency(listing["ListPrice"]) %>", 
            "PropertyType": "<%= listing["PropertyType"] %>",
            "FullStreetAddress": "<%= listing["FullStreetAddress"] %>",
            "City": "<%= listing["City"] %>",
            "State": "<%= listing["State"] %>",
            "ZipCode": "<%= listing["ZipCode"] %>",
            "BedroomsTotal": "<%= listing["BedroomsTotal"] %>",
            "BathsTotal": "<%= listing["BathsTotal"] %>",
            "BuildingSize": "<%= listing["BuildingSize"] %>",
            "LotSizeSQFT": "<%= listing["LotSizeSQFT"] %>",
            "YearBuilt": "<%= listing["YearBuilt"] %>",
            "ListingModificationDate": "<%= listing["ListingModificationDate"] %>",
            "Area": "<%= listing["Area"] %>",
            "ListingDate": "<%= listing["ListingDate"] %>",
            "BuildersTractName": "<%= listing["BuildersTractName"] %>",
            "PublicRemarks": "<%= listing["PublicRemarks"] %>",
            "PropertyMedia": [
                    <% listing.property_media.each_with_index do |pm, i| %>
                        <% if i == listing.property_media.length - 1 %>
                            {
                                "PropItemNumber": "<%= pm.PropItemNumber  %>",
                                "PropMediaURL": "<%= pm.PropMediaURL %>"
                            }
                        <% else %>
                            {
                                "PropItemNumber": "<%= pm.PropItemNumber  %>",
                                "PropMediaURL": "<%= pm.PropMediaURL %>"
                            },
                        <% end %>
                    <% end %>
                ]},
        <% end %>
    <% end %>
    }
}
